<script>
    var updater;

    var start = () => {
        document.getElementById("teamNumber").innerHTML = document.cookie.slice(document.cookie.indexOf("teamNumber=") + 11, document.cookie.indexOf("teamNumber=") + 12);
        updateTime();
        updater = setInterval(updateTime,1000);
        setTimeout(() => {
            document.getElementById("contentBox").style.width = `${document.getElementById("timerBox").getBoundingClientRect().width}px`;
        },100);
    }

    var blinkColon = () => {

    }

    var addZero = (number) => {
        if (number < 10) return "0" + number;
        return number;
    }

    var updateTime = () => {
        let bru = {
            command: "getStatus",
            teamNumber: document.cookie.slice(document.cookie.indexOf("teamNumber=") + 11, document.cookie.indexOf("teamNumber=") + 12)
        }
        fetch('/', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                }, body: JSON.stringify(bru)
            }).then(data => data.text())
                .then(html => { 
                    if (html === "teamInvalid") {
                        alert("Team has not yet been made");
                        document.cookie = `teamNumber=; expires=Thu, 18 Dec 2013 12:00:00 UTC; path=/;`;
                        clearInterval(updater);
                        location.reload();
                        return;
                    }
                    let nsa = JSON.parse(html);
                    document.getElementById("teamName").innerHTML = nsa.name;
                    let timeString;
                    if (typeof nsa.completionTime === 'undefined')
                        timeString = `${addZero(Math.floor(nsa.time / 60))}:${addZero(nsa.time - Math.floor(nsa.time / 60)*60 )}`;
                    else {
                        timeString = `${addZero(Math.floor(nsa.completionTime / 60))}:${addZero(nsa.completionTime - Math.floor(nsa.completionTime / 60)*60 )}`;
                        if (nsa.completionTime == 0) {
                            // Add lose functionality
                        } else {
                            document.getElementById("timerBox").style.backgroundColor = "rgb(62,217,74)";
                            document.getElementById("ghostTime").style.color = "rgb(45 163 55)";
                        }
                    }
                    document.getElementById("theTime").innerHTML = timeString;
                });
    }

    var keypadInput = (i) => {
        if(i === '#') {
            fetch('/', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                }, body: JSON.stringify({
                    command: "submitCode", 
                    code: Number(document.getElementById("passwordBox").innerHTML), 
                    teamNumber: document.cookie.slice(document.cookie.indexOf("teamNumber=") + 11, document.cookie.indexOf("teamNumber=") + 12)
                })
            }).then(data => data.text())
                .then(html => { 
                    alert(html);
                })
            return;
        }

        if(i === '*') {
            document.getElementById("passwordBox").innerHTML = '';
            return;
        }

        document.getElementById("passwordBox").innerHTML += i;

    }

</script>

<style>
    .timerTime {
        font-family: D7MBI;
        font-size: 20vw;
    }

    .keypadButton {
        width: 30%;
        aspect-ratio: 2;
        margin-top: 5px;
        font-family: PNSB;
        font-size: 1.5rem;
    }
</style>

<div id="contentBox" style="display: flex; flex-direction: column; margin:auto;">
    <div style="display: flex; flex-direction: row; width: 100%;">
        <h2 id="teamName" style="text-align: left; width:90%; font-family: PNSB; overflow: hidden;">Name</h2>
        <h2 id="teamNumber" style="text-align: right; width:10%; font-family: PNSB;">No.</h2>
    </div>
    <div id="timerBox" style="position:relative; background-color: rgb(169, 27, 27); padding: 10px; width: fit-content; border-radius: 10px; border: 2px solid #000000;">
        <div class="timerTime" id="ghostTime" style="color: rgb(132, 20, 20);position: absolute;">88:88</div>
        <div class="timerTime" id="theTime" style="color: rgb(0, 0, 0);position: relative;">15:00</div>
    </div>
    <div id="passwordBox" style="background-color: #B8B500; padding: 10px; border-radius: 10px; border: 2px solid #000000; margin-top: 10px; font-family: PNSB;">

    </div>
    <div id="keypad" style="display: flex; flex-direction: row; flex-wrap: wrap; width: 100%; justify-content: space-around;">
        <input type="button" class="keypadButton" onclick="keypadInput(1)" value="1">
        <input type="button" class="keypadButton" onclick="keypadInput(2)" value="2">
        <input type="button" class="keypadButton" onclick="keypadInput(3)" value="3">
        <input type="button" class="keypadButton" onclick="keypadInput(4)" value="4">
        <input type="button" class="keypadButton" onclick="keypadInput(5)" value="5">
        <input type="button" class="keypadButton" onclick="keypadInput(6)" value="6">
        <input type="button" class="keypadButton" onclick="keypadInput(7)" value="7">
        <input type="button" class="keypadButton" onclick="keypadInput(8)" value="8">
        <input type="button" class="keypadButton" onclick="keypadInput(9)" value="9">
        <input type="button" class="keypadButton" onclick="keypadInput('*')" value="*">
        <input type="button" class="keypadButton" onclick="keypadInput(0)" value="0">
        <input type="button" class="keypadButton" onclick="keypadInput('#')" value="#">
    </div>


</div>